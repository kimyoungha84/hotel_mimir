<!DOCTYPE html>
<html xmlns="http://www.thymeleaf.org">
<head>
<!-- favicon 설정 -->
<link rel="icon shortcut"  href="/admin_common_assets/common_img/mimir_favicon.ico"/>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- jquery CDN -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

<th:block th:replace="~{administrator/fragments/admin_header :: admin_header}"></th:block>

<!-- chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
.dashboard {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
    justify-items: center;
}
.chart-card {
    width: 300px;
    padding: 1rem;
    border-radius: 12px;
    background-color: #ffffff;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transition: box-shadow 0.3s;
}

.chart-card:hover {
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15); 
}

.card-title {
    font-size: 1.1rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
    text-align: center;
}
</style>

</head>
<body>

<th:block th:replace="~{administrator/fragments/admin_sidebar :: admin_sidebar}"></th:block>

<div id="body-pd" class="body-pd">
<h2 class="h2Title">객실 대쉬보드</h2>
<hr/>

<div class="dashboard">
    <div class="chart-card">
        <div class="card-title">월별 매출</div>
        <canvas id="myChart" width="280" height="200"></canvas>
    </div>

    <div class="chart-card">
        <div class="card-title">회원/비회원 비율</div>
        <canvas id="myChart2" width="280" height="200"></canvas>
    </div>

    <div class="chart-card">
        <div class="card-title">인기 객실 유형 Top 3</div>
        <canvas id="myChart3" width="280" height="200"></canvas>
    </div>
    
    <div class="chart-card">
        <div class="card-title">객실 점유율</div>
        <canvas id="myChart4" width="280" height="200"></canvas>
    </div>

    <div class="chart-card">
        <div class="card-title">월별 고객 방문 수 추이</div>
        <canvas id="myChart5" width="280" height="200"></canvas>
    </div>

    <div class="chart-card">
        <div class="card-title">결제 유형별 매출 비중</div>
        <canvas id="myChart6" width="280" height="200"></canvas>
    </div>
</div>



</div>

<script th:inline="javascript">
/*<![CDATA[*/
    const monthlySales = /*[[${monthlySales}]]*/ [];
    const monthlyReservations = /*[[${monthlyReservations}]]*/ [];
    const memberRatio = /*[[${memberRatio}]]*/ [];
    const popularRooms = /*[[${popularRooms}]]*/ [];
    const todayStatus = /*[[${todayStatus}]]*/ {};
    const roomOccupancy = /*[[${roomOccupancy}]]*/ [];
/*]]>*/

// null 체크 JS에서 처리
const safeTodayStatus = todayStatus || { checkinCount: 0, checkoutCount: 0 };

// 5. 당일 예약 현황 (체크인, 체크아웃 수)
const todayLabels = ['체크인', '체크아웃'];
const todayData = [safeTodayStatus.checkinCount, safeTodayStatus.checkoutCount];

    // 1. 월별 매출 차트
    const salesLabels = monthlySales.map(item => item.month + '월');
    const salesData = monthlySales.map(item => item.salesAmount);

    new Chart(document.getElementById('myChart'), {
        type: 'line',
        data: {
            labels: salesLabels,
            datasets: [{
                label: '월별 매출',
                data: salesData,
                borderColor: '#c2a164',
                backgroundColor: 'rgba(194, 161, 100, 0.2)',
                tension: 0.3,
                fill: true
            }]
        },
        options: { responsive: true }
    });

    // 2. 월별 예약 수 (고객 방문 수)
    const reservationLabels = monthlyReservations.map(item => item.month + '월');
    const reservationData = monthlyReservations.map(item => item.reservationCount);

    new Chart(document.getElementById('myChart5'), {
        type: 'bar',
        data: {
            labels: reservationLabels,
            datasets: [{
                label: '고객 방문 수',
                data: reservationData,
                backgroundColor: '#c2a164'
            }]
        },
        options: { responsive: true }
    });

    // 3. 회원/비회원 비율
    const memberLabels = memberRatio.map(item => item.category);
    const memberData = memberRatio.map(item => item.value);

    new Chart(document.getElementById('myChart2'), {
        type: 'pie',
        data: {
            labels: memberLabels,
            datasets: [{
                label: '회원/비회원 비율',
                data: memberData,
                backgroundColor: ['#c2a164', '#d9c39a']
            }]
        },
        options: { responsive: true }
    });

    // 4. 인기 객실 (객실별 예약 수)
    const roomLabels = popularRooms.map(item => item.roomType);
    const roomCounts = popularRooms.map(item => item.reservationCount);

    new Chart(document.getElementById('myChart3'), {
        type: 'bar',
        data: {
            labels: roomLabels,
            datasets: [{
                label: '객실별 예약 수',
                data: roomCounts,
                backgroundColor: '#c2a164'
            }]
        },
        options: { responsive: true }
    });

    // 5. 당일 예약 현황 (체크인, 체크아웃 수)

    new Chart(document.getElementById('myChart6'), {
        type: 'doughnut',
        data: {
            labels: todayLabels,
            datasets: [{
                data: todayData,
                backgroundColor: ['#c2a164', '#e0cfa5']
            }]
        },
        options: { responsive: true }
    });

    // 6. 객실 점유율
    const occupancyLabels = roomOccupancy.map(item => item.roomType);
    const occupancyRates = roomOccupancy.map(item => item.occupancyRate);

    new Chart(document.getElementById('myChart4'), {
        type: 'bar',
        data: {
            labels: occupancyLabels,
            datasets: [{
                label: '객실 점유율 (%)',
                data: occupancyRates,
                backgroundColor: '#c2a164'
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    min: 0,
                    max: 100,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            }
        }
    });
</script>


</body>
</html>
