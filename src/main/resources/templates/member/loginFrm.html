<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>로그인</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<div class="container mt-5" style="max-width: 400px;">
    <h3 class="text-center mb-4">로그인</h3>

    <div class="mb-3">
        <label for="email_id" class="form-label">이메일</label>
        <input type="email" class="form-control" id="email_id" required />
    </div>

    <div class="mb-3">
        <label for="password" class="form-label">비밀번호</label>
        <input type="password" class="form-control" id="password" required />
    </div>

    <button type="button" class="btn btn-dark w-100" onclick="login()">로그인</button>

    <div class="text-center mt-3">
        <a href="/member/registerFrm">회원가입</a>
    </div>

    <div id="loginMessage" class="text-danger mt-3 text-center"></div>
</div>

<script>
function login() {
    const email = document.getElementById("email_id").value;
    const password = document.getElementById("password").value;

    fetch("/member/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email_id: email, password: password })
    })
    .then(res => {
        if (!res.ok) {
            throw new Error("로그인 실패");
        }
        return res.json();
    })
    .then(data => {
        //토큰 저장
        localStorage.setItem("access_token", data.accessToken);
        localStorage.setItem("refresh_token", data.refreshToken);

        //메인 페이지로 이동
        window.location.href = "/";
    })
    .catch(err => {
        document.getElementById("loginMessage").innerText = "이메일 또는 비밀번호가 올바르지 않습니다.";
    });
}
</script>
</body>
</html>