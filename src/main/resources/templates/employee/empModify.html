<!DOCTYPE html>
<html xmlns="http://www.thymeleaf.org">
<head>
<!-- favicon 설정 -->
<link rel="icon shortcut"  href="/admin_common_assets/common_img/mimir_favicon.ico"/>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- jquery CDN -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

<th:block th:replace="~{administrator/fragments/admin_header :: admin_header}"></th:block>

<!-- Vue CDN -->
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<!-- axios CDN -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<style>
    .regEmpBtn{
    background-color: #eacdc1;
    border: none;
    padding: 0.5rem 1rem;
    font-size: 0.95rem;
    font-weight: 500;/*=400, normal*/
    color: #000;
    border-radius: 6px;
    cursor: pointer;
    margin-bottom: 1rem;
    margin-right: 10rem;
    float: right;


}

.regEmpBtn:hover{
    background-color: #ddbfb3;
}
</style>
<script th:inline="javascript">

const sDomainJSON=[[${staffDomain}]];
//const sDomainJSON=JSON.parse(sDomainJSONstr);

// console.log("sDomainJSON입니다.");
// console.log(sDomainJSON);
</script>
</head>
<body>
<th:block th:replace="~{administrator/fragments/admin_sidebar :: admin_sidebar}"></th:block>

<div id="body-pd" class="body-pd">
<h2 class="h2Title">직원 수정</h2>
<hr/>

<div id="app">
<table class="vertical-table">
<thead>
<tr>
    <th>아이디</th>
    <td id="staffId" th:text="${staffDomain.staff_id}"></td>
</tr>
<tr>
    <th>이름</th>
    <td th:text="${staffDomain.staff_name}"></td>
</tr>
<tr>
    <th>이메일</th>
    <td th:text="${staffDomain.staff_email}"></td>
</tr>
<tr>
    <th>부서</th>
    <td>
        <select id="dept" v-model="staffDomainJSON.dept_iden">
        <option  :value="''" th:text="-----선택-----" disabled selected></option>
        <option v-for="dept in this.depts" :value="dept.dept_iden" :key="dept.dept_iden">{{dept.dept_name}}</option>
        </select>
    </td>
</tr>
<tr>
    <th>직책</th>
    <td>
        <select id="position" v-model="staffDomainJSON.position_identified_code">
        <option :value="''" th:text="---선택---" disabled selected></option>
        <option v-for="position in this.positions" :value="position.position_iden_code" :key="position.position_iden_code">{{position.position_name}}</option>
        </select>
    </td>
</tr>
<tr>
    <th>권한</th>
    <td style="display: flex; align-items: center;">
    <div style="flex: 1;">
    <div v-for="authority in authorities" :key="authority.permission_id">
    <label>
    <input type="checkbox" :value="authority.permission_type" v-model="this.permissionArr">
    {{ authority.permission_type }}
    </label>
    </div>

    </div>

    </td>
</tr>
<tr>
    <th>상태</td>
    <td>
        <select id="status" v-model="staffDomainJSON.staff_status">
        <option :value="''" th:text="---선택---" disabled selected></option>
        <option v-for="status in this.statuses" :value="status.staff_status" :key="status.staff_status">{{status.staff_status_kor}}</option>
        </select>
    </td>
</tr>
<tr>
    <th>입사일</th>
    <td th:text="${staffDomain.date_of_employment}"></td>
</tr>
</tbody>
</table>


<div class="btnGroup" style="margin-left:50rem;">
<input type="button" class="darkBtn" value="확인" @click="modifyBtn"/>
<input type="button" class="softBtn" value="취소" @click="cancelBtn"/>
</div>
</div>
</div>



<script>
Vue.createApp({
    data(){
        return{
            staffDomainJSON : sDomainJSON,
            flag : "",
            authoritySelector:"",
            permissionArr:[],
            depts :[
                {dept_iden:"room", dept_name:"객실 관리"},
                {dept_iden:"dinning", dept_name:"다이닝 관리"},
                {dept_iden:"inquiry", dept_name:"문의 관리"},
                {dept_iden:"person", dept_name:"인사 관리"},
                {dept_iden:"member", dept_name:"회원 관리"},
                {dept_iden:"manage", dept_name:"경영지원"},
            ],
            positions:[
                {position_iden_code:"B", position_name:"팀장"},
                {position_iden_code:"C", position_name:"과장"},
                {position_iden_code:"D", position_name:"대리"},
                {position_iden_code:"E", position_name:"사원"}
            ],
            authorities:[
                {permission_id:"room", permission_type:"객실"},
                {permission_id:"dinning", permission_type:"다이닝"},
                {permission_id:"inquiry", permission_type:"문의"},
                {permission_id:"member", permission_type:"회원"},
                {permission_id:"employee", permission_type:"직원"}

            ],
            statuses:[
                {staff_status:"ACTIVE", staff_status_kor:"재직"},
                {staff_status:"DEACTIVE", staff_status_kor:"퇴사"},
            ]
        }
    },
    mounted(){
        const raw = this.staffDomainJSON.permission_str_kor;
        this.permissionArr = raw ? raw.split(',') : [];
    },
    methods:{
        modifyBtn(){

            this.staffDomainJSON.permission_str_kor=this.permissionArr.join(',');
            

            axios.post("/admin/employee/modifySend",this.staffDomainJSON)
            .then(res=>{
                if(res.data ==="true" || res.data === true){
                    alert("수정을 완료했습니다.");
                    location.href="/admin/employee/detail?staff_id="+this.staffDomainJSON.staff_id;
                }else{
                    alert("수정에 실패했습니다.\n값들을 다시 확인해 주세요.");
                }
            })
            .catch(err=>{
                alert("수정에 실패했습니다.\n값들을 다시 확인해 주세요.");
            });
        },
        cancelBtn(){
            // 이전 페이지로 돌아가면서 새로 고침
            history.go(-1);  // 뒤로가기
            setTimeout(function() {
                 // 뒤로가기를 한 후에, 페이지 새로 고침을 강제 실행
                location.reload();
             }, 500); // 0.5초 정도 대기 후 새로 고침
        },

    }
}).mount("#app");
</script>

</body>
</html>