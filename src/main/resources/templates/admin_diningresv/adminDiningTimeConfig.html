<!DOCTYPE html>
<html xmlns="http://www.thymeleaf.org">
<head>
  <!-- favicon 설정 -->
  <link rel="icon shortcut" href="/admin_common_assets/common_img/mimir_favicon.ico" />
  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="/admin_common_assets/js/pagination.js"></script>

  <!-- jQuery CDN -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

  <th:block th:replace="~{administrator/fragments/admin_header :: admin_header}"></th:block>

  <style>
  input[type="text"],
  input[type="number"],
  input[type="date"],
  select,
  textarea {
    padding: 0.5rem 0.7rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
    background-color: #fff;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }

  input:focus,
  select:focus,
  textarea:focus {
    border-color: #111;
    box-shadow: 0 0 4px rgba(17, 17, 17, 0.3);
    outline: none;
  }
  
    .save-btn {
      background-color: #4CAF50;
      color: white;
      padding: 0.4rem 0.8rem;
      font-size: 1rem;
      border: none;
      border-radius: 0.3rem;
      cursor: pointer;
      transition: background-color 0.3s;
    }
  </style>
</head>

<body>
<th:block th:replace="~{administrator/fragments/admin_sidebar :: admin_sidebar}"></th:block>

  <div id="body-pd" class="body-pd">
    <h2 class="h2Title">다이닝 시간 슬롯</h2>
    <hr/>

    <!-- 성공 메시지 -->
    <div th:if="${successMessage}" style="color: green; font-weight: bold; margin: 1rem 0; text-align: center;">
      <p th:text="${successMessage}"></p>
    </div>

    <!-- 에러 메시지 -->
    <div th:if="${errorMessage}" style="color: red; font-weight: bold; margin: 1rem 0; text-align: center;">
      <p th:text="${errorMessage}"></p>
    </div>

    <!-- 시간 슬롯 추가 폼 -->
    <form id="addTimeSlotForm" th:action="@{/admin/insertTimeSlot}" method="post" style="margin-bottom: 2rem;">
      <label for="diningId">다이닝 선택 :</label>
      <select name="diningId" required>
        <option th:each="dining : ${diningList}" th:value="${dining.dining_id}" th:text="${dining.dining_name}"></option>
      </select>

      <label for="mealType" style="margin-left: 1rem;">식사 유형 :</label>
      <select name="mealType" required>
        <option value="Lunch">Lunch</option>
        <option value="Dinner">Dinner</option>
      </select>

      <label for="timeSlot" style="margin-left: 1rem;">시간 입력 (예 : 12:30) :</label>
      <input type="text" name="timeSlot" placeholder="HH:mm" required pattern="^([01]\d|2[0-3]):([0-5]\d)$"/>

      <button type="submit" class="save-btn" style="margin-left: 1rem;">추가</button>
    </form>

    <!-- 등록된 시간 슬롯 테이블 -->
    <h3>등록된 시간대</h3>
    <table>
      <thead>
        <tr>
          <th>다이닝</th>
          <th>식사 유형</th>
          <th>시간</th>
          <th>--</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="slot : ${timeSlotList}">
          <td th:text="${slot.diningName}"></td>
          <td th:text="${slot.mealType}"></td>
          <td th:text="${slot.timeSlot}"></td>
          <td>
            <form class="deleteSlotForm" th:action="@{/admin/deleteTimeSlot}" method="post" style="display:inline;">
              <input type="hidden" name="configId" th:value="${slot.configId}" />
              <button type="submit" class="save-btn" style="background-color: #f44336">삭제</button>
            </form>
          </td>
        </tr>
        <tr th:if="${#lists.isEmpty(timeSlotList)}">
          <td colspan="4" style="text-align: center;">등록된 시간이 없습니다.</td>
        </tr>
      </tbody>
    </table>
  </div>
  
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // 추가 확인
    const addForm = document.getElementById("addTimeSlotForm");
    if (addForm) {
      addForm.addEventListener("submit", function (e) {
        const confirmed = confirm("해당 시간 슬롯을 추가하시겠습니까?");
        if (!confirmed) {
          e.preventDefault();
        }
      });
    }

    // 삭제 확인
    const deleteForms = document.querySelectorAll(".deleteSlotForm");
    deleteForms.forEach(form => {
      form.addEventListener("submit", function (e) {
        const confirmed = confirm("정말 해당 시간 슬롯을 삭제하시겠습니까?");
        if (!confirmed) {
          e.preventDefault();
        }
      });
    });
  });
</script>
  
</body>
</html>