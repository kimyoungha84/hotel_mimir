<div th:fragment="filter(filter)"> 
  <style>
    /* 유니크한 클래스로 스타일 지정 */
    .filter-form {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 20px;
      margin-top: 10px;
      margin-bottom: 30px;
    }

    .filter-date-picker {
      display: flex;
      flex: 1;
      gap: 10px;
    }

    .filter-date-picker input[type="date"] {
      border: 1px solid #ddd;
      padding: 5px;
      border-radius: 4px;
      width: 150px;  /* 크기 줄이기 */
      font-size: 14px;
    }

    .filter-right-section {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .filter-selector {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .filter-select-box {
      padding: 5px;
      font-size: 14px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 150px;
    }

    .filter-search-text {
      flex: 1;
    }

    .filter-input {
      width: 300px;  /* 검색창 크기 키우기 */
      padding: 8px 12px;  /* 텍스트 입력 패딩 추가 */
      font-size: 14px;
      border: 1px solid #ddd;
      border-radius: 4px;
      height: 40px;
    }

    .filter-search-btn {
      padding: 8px 15px;  /* 버튼 크기 약간 키우기 */
      font-size: 14px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .filter-search-btn:hover {
      background-color: #45a049;
    }

    /* 모바일 대응 */
    @media (max-width: 768px) {
      .filter-form {
        flex-direction: column;
        gap: 15px;
      }

      .filter-right-section {
        flex-direction: column;
        align-items: flex-start;
      }

      .filter-search-text input,
      .filter-select-box {
        width: 100%;
      }

      .filter-input {
        width: 100%;  /* 모바일에서는 전체 크기로 확장 */
      }
    }
  </style>

  <form id="searchApiForm" class="filter-form">
    
    <!-- 왼쪽: Date Picker -->
    <div th:if="${filter.showDatePicker}" class="filter-date-picker">
      <input type="hidden" name="dateName" th:value="${filter.filteringDateName}" />
      <input type="date" name="startDate" th:value="${param.startDate}" />
      <input type="date" name="endDate" th:value="${param.endDate}" />
    </div>
    
<!-- 🔹 라벨 + 셀렉터 (가로 배치) -->
<div th:if="${filter.labelSelectorOptions != null and #lists.size(filter.labelSelectorOptions) > 0}" 
     style="display: flex; flex-wrap: wrap; gap: 10px;">
  <div th:each="selector : ${filter.labelSelectorOptions}" class="filter-selector">
    <label th:text="${selector.label}"></label>
    <select class="filter-select-box" th:name="${selector.selectorName}">
      <option th:each="opt : ${selector.options}" 
              th:value="${opt.label}" 
              th:text="${opt.label}">옵션</option>
    </select>
  </div>
</div>

    

    <!-- 오른쪽: 콤보박스, 텍스트 입력, 검색 버튼 -->
    <div class="filter-right-section">
      
      <!-- 셀렉터가 1개일 경우, 라벨만 표시 -->
      <div th:if="${filter.showSelector}" class="filter-selector">
      	<input type="hidden" name="searchType" th:value="${filter.selectOptions[0].value}" />
        <span th:if="${#lists.size(filter.selectOptions) == 1}" th:text="${filter.selectOptions[0].label}"></span>
        <!-- 셀렉터가 2개 이상일 경우에만 select box 표시 -->
        <select th:if="${#lists.size(filter.selectOptions) > 1}" name="searchType" class="filter-select-box">
          <option th:each="opt : ${filter.selectOptions}" 
                  th:value="${opt.value}" th:text="${opt.label}">검색</option>
        </select>
      </div>

      <!-- 텍스트 입력 -->
      <div th:if="${filter.showSearchText}" class="filter-search-text">
        <input type="text" name="searchKeyword" th:value="${param.searchKeyword}" placeholder="검색어 입력" class="filter-input" />
      </div>

      <!-- 검색 버튼 -->
      <button type="button" id="searchApiBtn" class="filter-search-btn">검색</button>
    </div>

    <!-- 숨겨진 필드들 -->
    <input type="hidden" name="currentPage" th:value="${currentPage}" />
    <input type="hidden" name="pageSize" th:value="${pageSize}" />
    
  </form>

<script th:inline="javascript">
(function () {
  const $btn = document.getElementById("searchApiBtn");
  const $form = document.getElementById("searchApiForm");

  $form.addEventListener("keydown", function(event) {
    if (event.key === "Enter") {
      event.preventDefault();
    }
  });

  $btn?.addEventListener("click", function () {
	  
	  
	const params = new URLSearchParams(new FormData($form));
	window.lastSearchParams = new URLSearchParams(params);
	
	params.set("filterType", /*[[${filterType}]]*/ 'someFilterType');
    params.set("filter_fragmentTemplate", /*[[${filter_fragmentTemplate}]]*/);
    params.set("filter_fragmentName", /*[[${filter_fragmentName}]]*/);
    params.set("filter_resultKey", /*[[${filter_resultKey}]]*/ );

    // 검색 결과 요청
    fetch('/search?' + params.toString())
      .then(res => res.text())
      .then(html => {
        // 결과 영역 갱신
        document.getElementById("resultArea").innerHTML = html;

        // 🔹 1. count 요청
      		fetch('/count?' + params.toString())
			  .then(res => res.json())
			  .then(json => {
			    const totalItems = json.totalItems;
			    console.log("총 개수:", totalItems);
			    params.set("totalItems", totalItems);


            // 🔹 3. 페이지네이션 요청
            fetch('/reBuildPagination?' + params.toString())
              .then(res => res.text())
              .then(paginationHtml => {
                document.getElementById("paginationArea").innerHTML = paginationHtml;
              });
          });
      });
  });
})();
</script>


</div>
