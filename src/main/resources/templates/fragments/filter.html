<div th:fragment="filter(filter)">
  <form id="searchForm" style="display: flex; align-items: center; justify-content: space-between;">
    
    <!-- ì™¼ìª½: Date Picker -->
    <div th:if="${filter.showDatePicker}" style="flex: 1; display: flex; justify-content: flex-start; gap: 10px;">
      <input type="hidden" name="dateName" th:value="${filter.filteringDateName}" />
      <input type="date" name="startDate" th:value="${param.startDate}" />
      <input type="date" name="endDate" th:value="${param.endDate}" />
    </div>

    <!-- ì˜¤ë¥¸ìª½: ì½¤ë³´ë°•ìŠ¤, í…ìŠ¤íŠ¸ ìž…ë ¥, ê²€ìƒ‰ ë²„íŠ¼ -->
    <div style="display: flex; align-items: center; gap: 10px;">
      
      <!-- ì…€ë ‰í„°ê°€ 1ê°œì¼ ê²½ìš°, ë¼ë²¨ë§Œ í‘œì‹œ -->
      <div th:if="${filter.showSelector}">
      	<input type="hidden" name="searchType" th:value="${filter.selectOptions[0].value}" />
        <span th:if="${#lists.size(filter.selectOptions) == 1}" th:text="${filter.selectOptions[0].label}"></span>
        <!-- ì…€ë ‰í„°ê°€ 2ê°œ ì´ìƒì¼ ê²½ìš°ì—ë§Œ select box í‘œì‹œ -->
        <select th:if="${#lists.size(filter.selectOptions) > 1}" name="searchType" style="width: 150px;">
          <option th:each="opt : ${filter.selectOptions}" 
                  th:value="${opt.value}" th:text="${opt.label}">ê²€ìƒ‰</option>
        </select>
      </div>

      <!-- í…ìŠ¤íŠ¸ ìž…ë ¥ -->
      <div th:if="${filter.showSearchText}" style="flex: 1;">
        <input type="text" name="searchKeyword" th:value="${param.searchKeyword}" placeholder="ê²€ìƒ‰ì–´ ìž…ë ¥" style="width: 200px;" />
      </div>

      <!-- ê²€ìƒ‰ ë²„íŠ¼ -->
      <button type="button" id="searchBtn" style="padding: 5px 10px; font-size: 14px;">ê²€ìƒ‰</button>
    </div>

    <!-- ìˆ¨ê²¨ì§„ í•„ë“œë“¤ -->
    <input type="hidden" name="filterType" th:value="${filter.filterType}" />
    <input type="hidden" name="filter_fragmentTemplate" th:value="${filter_fragmentTemplate}" />
    <input type="hidden" name="filter_fragmentName" th:value="${filter_fragmentName}" />
    <input type="hidden" name="filter_resultKey" th:value="${filter_resultKey}" />
    <input type="hidden" name="currentPage" th:value="${currentPage}" />
    <input type="hidden" name="pageSize" th:value="${pageSize}" />
    
  </form>

<script th:inline="javascript">
(function () {
  const $btn = document.getElementById("searchBtn");
  const $form = document.getElementById("searchForm");

  $form.addEventListener("keydown", function(event) {
    if (event.key === "Enter") {
      event.preventDefault();
    }
  });

  $btn?.addEventListener("click", function () {
	  
	const params = new URLSearchParams(new FormData($form));
	window.lastSearchParams = new URLSearchParams(params);

    // ê²€ìƒ‰ ê²°ê³¼ ìš”ì²­
    fetch('/search?' + params.toString())
      .then(res => res.text())
      .then(html => {
        // ê²°ê³¼ ì˜ì—­ ê°±ì‹ 
        document.getElementById("resultArea").innerHTML = html;

        // ðŸ”¹ 1. count ìš”ì²­
      		fetch('/count?' + params.toString())
			  .then(res => res.json())
			  .then(json => {
			    const totalItems = json.totalItems;
			    console.log("ì´ ê°œìˆ˜:", totalItems);
			    params.set("totalItems", totalItems);


            // ðŸ”¹ 3. íŽ˜ì´ì§€ë„¤ì´ì…˜ ìš”ì²­
            fetch('/reBuildPagination?' + params.toString())
              .then(res => res.text())
              .then(paginationHtml => {
                document.getElementById("paginationArea").innerHTML = paginationHtml;
              });
          });
      });
  });
})();
</script>


</div>
