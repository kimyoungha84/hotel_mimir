<!DOCTYPE html>
<html xmlns="http://www.thymeleaf.org" lang="ko">
<head>
<meta charset="UTF-8">
<title>다이닝 정보 수정</title>
<link rel="stylesheet" href="/admin_common_assets/css/common.css">

<!-- jQuery 추가 -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

<!-- CSS 파일 포함 -->
<link rel="stylesheet" th:href="@{/dining/css/admin_dining_edit.css}">
</head>
<body>
<th:block th:replace="~{administrator/fragments/admin_header :: admin_header}"></th:block>
<th:block th:replace="~{administrator/fragments/admin_sidebar :: admin_sidebar}"></th:block>
<div class="body-pd">
  <main class="main-content">
    <section class="dining-section">
      <h1>다이닝 정보 수정</h1>
      
      <!-- 메시지 표시 영역 -->
      <div th:if="${message}" class="message-area" style="margin-bottom: 20px; padding: 10px; background-color: #e8f5e8; border: 1px solid #4caf50; border-radius: 4px;">
        <span th:text="${message == 'dataUpdated' ? '데이터가 성공적으로 수정되었습니다.' : 
                        message == 'filesUpdated' ? '파일이 성공적으로 업로드되었습니다.' : message}"></span>
      </div>

      <!-- 일반 데이터 폼 -->
      <form id="diningDataForm" th:action="@{/admin/dining/edit}" method="post">
        <input type="hidden" name="dining_id" th:value="${dining.dining_id}" />

        <div class="form-data-section">
          <div class="form-data-title">기본 정보</div>
          <div class="edit-form-section">
            <label class="edit-form-label">이름</label>
            <input class="edit-form-input" type="text" name="dining_name" th:value="${dining.dining_name}" required />
          </div>
          <div class="edit-form-section">
            <label class="edit-form-label">타입</label>
            <select class="edit-form-select" name="type" required>
              <option value="한식" th:selected="${dining.type == '한식'}">한식</option>
              <option value="프렌치" th:selected="${dining.type == '프렌치'}">프렌치</option>
              <option value="회원제 레스토랑" th:selected="${dining.type == '회원제 레스토랑'}">회원제 레스토랑</option>
              <option value="레스토랑 & 바" th:selected="${dining.type == '레스토랑 & 바'}">레스토랑 & 바</option>
              <option value="스카이 바" th:selected="${dining.type == '스카이 바'}">스카이 바</option>
              <option value="프리미엄 베이커리 & 카페" th:selected="${dining.type == '프리미엄 베이커리 & 카페'}">프리미엄 베이커리 & 카페</option>
              <option value="인룸 다이닝" th:selected="${dining.type == '인룸 다이닝'}">인룸 다이닝</option>
            </select>
          </div>
          <div class="edit-form-section">
            <label class="edit-form-label">위치</label>
            <input class="edit-form-input" type="text" name="location" th:value="${dining.location}" required />
          </div>
          <div class="edit-form-section">
            <label class="edit-form-label">문의번호</label>
            <input class="edit-form-input" type="text" name="phone_number" th:value="${dining.phone_number}" required />
          </div>
          <div class="edit-form-section">
            <label class="edit-form-label">담당자</label>
            <input class="edit-form-input" type="text" name="manager_name" th:value="${dining.manager_name}" required />
          </div>
          <div class="edit-form-section">
            <label class="edit-form-label">예약 가능 여부</label>
            <select class="edit-form-select" name="dining_resv_availability">
              <option value="Y" th:selected="${dining.dining_resv_availability == 'Y'}">가능</option>
              <option value="N" th:selected="${dining.dining_resv_availability == 'N'}">불가능</option>
            </select>
          </div>
          <div class="edit-form-section">
            <label class="edit-form-label">분류</label>
            <select class="edit-form-select" name="dining_classification" required>
              <option value="레스토랑" th:selected="${dining.dining_classification == '레스토랑'}">레스토랑</option>
              <option value="라운지 &amp; 바" th:selected="${dining.dining_classification == '라운지 & 바'}">라운지 & 바</option>
              <option value="베이커리 &amp; 카페" th:selected="${dining.dining_classification == '베이커리 & 카페'}">베이커리 & 카페</option>
              <option value="룸서비스" th:selected="${dining.dining_classification == '룸서비스'}">룸서비스</option>
            </select>
          </div>
        </div>
        <div class="form-data-section">
          <div class="form-data-title">상세 정보</div>
          <div class="edit-form-section">
            <label class="edit-form-label">소개</label>
            <textarea class="edit-form-textarea" name="dining_introduction" rows="3" th:text="${dining.dining_introduction}"></textarea>
          </div>
          <div class="edit-form-section">
            <label class="edit-form-label">상세정보</label>
            <textarea class="edit-form-textarea" name="dining_detailinfo" rows="5" th:text="${dining.dining_detailinfo}"></textarea>
          </div>
          <div class="edit-form-section">
            <label class="edit-form-label">영업시간</label>
            <textarea class="edit-form-textarea" name="dining_operation_hours" rows="3" th:text="${dining.dining_operation_hours}"></textarea>
          </div>
        </div>
        <div class="edit-form-btn-area">
          <button type="button" class="list-btn modern-btn" id="submit-btn">데이터 수정</button>
        </div>
      </form>

      <hr style="margin: 40px 0; border: none; border-top: 2px solid #e0e0e0;">

      <!-- 파일 업로드 폼 -->
      <form id="diningFileForm" th:action="@{/admin/dining/editFiles}" method="post" enctype="multipart/form-data">
        <input type="hidden" name="dining_id" th:value="${dining.dining_id}" />

        <div class="file-upload-section">
          <div class="file-upload-title">메인 이미지</div>
          <div class="file-input-wrapper">
            <input type="file" name="main_image_file" accept="image/*" />
          </div>
          <input type="hidden" name="main_image_url" />
          <img th:if="${dining.dining_main_image != null}" th:src="@{${dining.dining_main_image}}" class="edit-form-img-preview" />
        </div>
        
        <div class="file-upload-section">
          <div class="file-upload-title">로고 이미지</div>
          <div class="file-input-wrapper">
            <input type="file" name="logo_image_file" accept="image/*" />
          </div>
          <input type="hidden" name="logo_image_url" />
          <img th:if="${dining.dining_logo_image != null}" th:src="@{${dining.dining_logo_image}}" class="edit-form-img-preview" />
        </div>
        
        <div class="file-upload-section">
          <div class="file-upload-title">케러셀 이미지 (여러 장 가능)</div>
          <div class="edit-form-img-list" id="carousel-img-list" style="display:flex; flex-direction:column; gap:0;">
            <th:block th:each="img, iterStat : ${dining.dining_carousel_images}">
              <div class="carousel-img-item" th:attr="data-index=${iterStat.index}" style="position:relative; display:flex; align-items:center; padding:12px 0; border-bottom:1px solid #e0e0e0;">
                <span style="width:32px; display:inline-block; text-align:center; font-weight:bold;">[[${iterStat.index + 1}]]</span>
                <img th:src="@{${img}}" style="max-width:120px; border:1px solid #ccc; border-radius:4px; margin:0 16px;" />
                <button type="button" class="action-btn delete-btn"
                        th:onclick="'deleteCarouselImage(this)'">삭제</button>
                <input type="file" th:name="'replace_carousel_image_' + ${iterStat.index}"
                       style="display:none;" th:onchange="'replaceCarouselImage(event, ' + ${iterStat.index} + ')'" />
                <button type="button" class="action-btn replace-btn" th:onclick="'triggerReplace(' + ${iterStat.index} + ')'">교체</button>
                <input type="hidden" name="carousel_image_urls" th:value="${img}" />
              </div>
            </th:block>
          </div>
        </div>

        <div class="edit-form-btn-area" style="margin-bottom: 100px;">
          <button type="button" class="list-btn modern-btn" onclick="saveCarouselImages()">이미지수정</button>
          <a th:href="@{/admin/dining}"><button type="button" class="list-btn modern-btn">뒤로가기</button></a>
        </div>
      </form>
    </section>
  </main>
</div>
<!-- JavaScript 파일 포함 -->
<script th:src="@{/dining/js/admin_dining_edit.js}"></script>

</body>
</html> 