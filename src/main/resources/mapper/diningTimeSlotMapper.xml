<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.sist.diningslot.DiningTimeSlotMapper">

  <!-- 예약된 인원 수 조회 -->
<select id="selectReservedCount" resultType="int">
  SELECT NVL(RESERVED_COUNT, 0)
  FROM DINING_TIME_SLOT
  WHERE DINING_ID = #{diningId}
    AND RESERVATION_DATE = #{reservationDate}
    AND RESERVATION_TIME = #{reservationTime}
</select>

  <!-- 슬롯 존재 여부 확인 -->
  <select id="existsSlot" resultType="int">
    SELECT COUNT(*)
    FROM DINING_TIME_SLOT
    WHERE DINING_ID = #{diningId}
      AND RESERVATION_DATE = #{reservationDate}
      AND RESERVATION_TIME = #{reservationTime}
  </select>

  <!-- 슬롯 삽입 -->
  <insert id="insertSlot">
    INSERT INTO DINING_TIME_SLOT (
      SLOT_ID,
      DINING_ID,
      RESERVATION_DATE,
      RESERVATION_TIME,
      RESERVED_COUNT
    ) VALUES (
      DINING_SLOT_SEQ.NEXTVAL,
      #{diningId},
      #{reservationDate},
      #{reservationTime},
      #{reservedCount}
    )
  </insert>

  <!-- 슬롯 업데이트 (좌석 수 증가) -->
  <update id="updateSlot">
    UPDATE DINING_TIME_SLOT
    SET RESERVED_COUNT = RESERVED_COUNT + #{reservedCount}
    WHERE DINING_ID = #{diningId}
      AND RESERVATION_DATE = #{reservationDate}
      AND RESERVATION_TIME = #{reservationTime}
  </update>

</mapper>